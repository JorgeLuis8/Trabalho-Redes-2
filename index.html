<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>HTTP Test Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: #f8f9fa;
    min-height: 100vh;
    padding: 2.5rem;
    color: #2d3748;
    line-height: 1.6;
  }
  .container { max-width: 1400px; margin: 0 auto; }
  .header {
    background: white;
    border-left: 4px solid #2563eb;
    padding: 2rem 2.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  }
  .header h1 { font-size: 1.75rem; font-weight: 600; color: #1a202c; margin-bottom: 0.5rem; }
  .header p { color: #718096; font-size: 0.95rem; }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
  }
  .panel {
    background: white;
    padding: 2rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    border-top: 3px solid #e2e8f0;
  }
  .panel:hover { border-top-color: #2563eb; }
  .panel-title {
    font-size: 1rem; font-weight: 600; color: #1a202c;
    margin-bottom: 1.5rem; padding-bottom: 0.75rem; border-bottom: 1px solid #e2e8f0;
  }
  label { display: block; font-size: 0.875rem; font-weight: 500; color: #4a5568; margin-bottom: 0.5rem; }
  input, select, button {
    width: 100%; padding: 0.625rem 0.875rem; border: 1px solid #d1d5db;
    font-size: 0.9375rem; transition: all 0.15s; background: white;
  }
  input:focus, select:focus {
    outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
  }
  button {
    background: #2563eb; color: white; border: none; cursor: pointer;
    padding: 0.75rem 1.5rem; font-weight: 500; transition: background 0.2s;
  }
  button:hover { background: #1e40af; }
  pre {
    background: #1e293b; color: #e2e8f0; padding: 1.25rem; overflow: auto;
    max-height: 500px; font-size: 0.8125rem; font-family: 'Courier New', monospace;
  }
  .info-box { background: #f0f9ff; border: 1px solid #bfdbfe; padding: 1rem; margin-top: 1rem; }
  .info-label { font-size: 0.8125rem; color: #1e40af; margin-bottom: 0.5rem; font-weight: 500; }
  .info-value { font-family: 'Courier New', monospace; font-size: 0.8125rem; color: #1e3a8a; word-break: break-all; }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>HTTP Performance Testing Dashboard</h1>
      <p>Comparação de desempenho entre servidores sequenciais e concorrentes</p>
    </div>

    <div class="grid">
      <div class="panel">
        <div class="panel-title">Identificação do Cliente</div>
        <label>Matrícula</label>
        <input id="matricula" type="text" value="20219040840">
        <label>Nome</label>
        <input id="nome" type="text" value="Jorge Luis Ferreira Luz">
        <div class="info-box">
          <div class="info-label">X-Custom-ID (SHA-1)</div>
          <div class="info-value" id="xcid">Calculando...</div>
        </div>
      </div>

      <div class="panel">
        <div class="panel-title">Requisição Individual</div>
        <label>Servidor</label>
        <select id="onceServer">
          <option value="seq">Sequencial (8080)</option>
          <option value="conc">Concorrente (8081)</option>
        </select>
        <label>Método HTTP</label>
        <select id="onceMethod">
          <option>GET</option><option>POST</option><option>PUT</option><option>DELETE</option>
        </select>
        <button id="sendOnce">Enviar Requisição</button>
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">Resposta HTTP Completa</div>
      <pre id="respBox">Aguardando requisição...</pre>
    </div>
  </div>

<script>
const SERVERS = {
  seq: "http://localhost:8080",
  conc: "http://localhost:8081"
};
const respBox = document.getElementById("respBox");

async function sha1Hex(str) {
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest("SHA-1", buf);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, "0")).join("");
}

async function updateCustomId() {
  const m = document.getElementById("matricula").value.trim();
  const n = document.getElementById("nome").value.trim();
  const x = await sha1Hex(`${m} ${n}`);
  document.getElementById("xcid").textContent = x;
  return x;
}

// Retorna todo o cabeçalho e o corpo permitido pelo CORS
async function fetchFormatted(url, method, xcid) {
  const resp = await fetch(url + "/", {
    method,
    headers: { "X-Custom-ID": xcid, "Content-Type": "text/plain" },
  });
  let out = `HTTP/1.1 ${resp.status} ${resp.statusText}\n`;
  const headers = Array.from(resp.headers.entries());
  headers.sort((a, b) => a[0].localeCompare(b[0]));
  for (const [k, v] of headers) out += `${k}: ${v}\n`;
  const body = await resp.text();
  out += "----- BODY -----\n" + body;
  return out;
}

document.getElementById("sendOnce").onclick = async () => {
  const xcid = await updateCustomId();
  const s = document.getElementById("onceServer").value;
  const m = document.getElementById("onceMethod").value;
  const url = SERVERS[s];
  try {
    const result = await fetchFormatted(url, m, xcid);
    respBox.textContent = result;
  } catch (e) {
    respBox.textContent = "Erro na requisição: " + e;
  }
};

updateCustomId();
</script>
</body>
</html>
